<table class="w-full" style="table-layout: fixed; width: 100%; max-width: 100%;">
    <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
            <th class="px-4 md:px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider" style="width: 18%; min-width: 100px;">Symbol</th>
            <th class="px-4 md:px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider" style="width: 22%; min-width: 120px; max-width: 250px;">Company</th>
            <th class="px-4 md:px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider whitespace-nowrap" style="width: 10%;">Price</th>
            <th class="px-4 md:px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider whitespace-nowrap" style="width: 8%;">Dividend</th>
            <th class="px-4 md:px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider whitespace-nowrap" style="width: 8%;">Yield</th>
            <th class="px-4 md:px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider whitespace-nowrap" style="width: 15%;">Ex-Date</th>
            <th class="px-4 md:px-6 py-4 text-center text-xs font-bold text-gray-700 uppercase tracking-wider whitespace-nowrap" style="width: 15%;">Actions</th>
        </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
        {% for item in watchlist_items %}
        <tr class="hover:bg-blue-50 transition-colors" data-stock-id="{{ item.stock.id }}">
            <!-- Symbol -->
            <td class="px-4 md:px-6 py-4" style="width: 18%; min-width: 100px;">
                <div class="flex items-start space-x-2">
                    <div class="flex-shrink-0 w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center shadow-md">
                        <span class="text-white font-bold text-sm">{{ item.stock.symbol|slice:":1" }}</span>
                    </div>
                    <div class="min-w-0 flex-1">
                        <div class="flex items-center space-x-1.5 mb-1 flex-wrap">
                            <span class="text-base font-bold text-gray-900">{{ item.stock.symbol }}</span>
                            {% if item.latest_dividend %}
                            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-700 border border-green-200 flex-shrink-0">
                                Div
                            </span>
                            {% endif %}
                            {% if item.in_portfolio %}
                            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-700 border border-blue-200 flex-shrink-0">
                                In Portfolio
                            </span>
                            {% endif %}
                            {% if item.tags %}
                            {% for tag in item.tags %}
                            <span class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-semibold text-white flex-shrink-0" style="background-color: {{ tag.color }};">
                                {{ tag.name }}
                            </span>
                            {% endfor %}
                            {% endif %}
                        </div>
                        <div class="text-xs text-gray-500 font-medium">
                            {% if item.latest_dividend and item.latest_dividend.frequency %}
                                {{ item.latest_dividend.frequency }}
                            {% else %}
                                {{ item.stock.code }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </td>
            
            <!-- Company Name -->
            <td class="px-4 md:px-6 py-4" style="width: 22%; min-width: 120px; max-width: 250px;">
                <div class="text-sm font-semibold text-gray-900" style="word-break: break-word; overflow-wrap: break-word; hyphens: auto; line-height: 1.4;">{{ item.stock.company_name }}</div>
                {% if item.stock.sector %}
                <div class="text-xs text-gray-500 mt-1" style="word-break: break-word; overflow-wrap: break-word; hyphens: auto;">{{ item.stock.sector }}</div>
                {% endif %}
            </td>
            
            <!-- Price -->
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-right" style="width: 10%;">
                {% if item.latest_price %}
                <div class="text-sm font-bold text-gray-900">${{ item.latest_price.last_price|floatformat:2 }}</div>
                <div class="flex items-center justify-end gap-2 mt-1">
                    {% if item.price_change_7d is not None %}
                    <span class="text-xs font-medium {% if item.price_change_7d >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
                        {% if item.price_change_7d >= 0 %}+{% endif %}{{ item.price_change_7d|floatformat:1 }}%
                    </span>
                    <span class="text-xs text-gray-400">7d</span>
                    {% endif %}
                </div>
                {% else %}
                <span class="text-sm text-gray-400">—</span>
                {% endif %}
            </td>
            
            <!-- Dividend -->
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-right" style="width: 8%;">
                {% if item.latest_dividend %}
                <div class="text-sm font-bold text-gray-900">${{ item.latest_dividend.amount|floatformat:4 }}</div>
                {% else %}
                <span class="text-sm text-gray-400">—</span>
                {% endif %}
            </td>
            
            <!-- Yield -->
            <td class="px-4 md:px-6 py-4 whitespace-nowrap text-right" style="width: 8%;">
                {% if item.latest_dividend and item.latest_dividend.yield_percent %}
                <div class="inline-flex items-center px-2 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200">
                    {{ item.latest_dividend.yield_percent|floatformat:2 }}%
                </div>
                {% else %}
                <span class="text-sm text-gray-400">—</span>
                {% endif %}
            </td>
            
            <!-- Ex-Date -->
            <td class="px-3 md:px-4 py-4 text-right" style="width: 15%;">
                {% if item.latest_dividend and item.latest_dividend.ex_dividend_date %}
                <div class="flex flex-col items-end">
                    <div class="flex items-center justify-end space-x-1 whitespace-nowrap">
                        <svg class="w-3 h-3 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span class="text-xs font-bold text-blue-600">{{ item.latest_dividend.ex_dividend_date|date:"M d" }}</span>
                    </div>
                    {% if item.days_until_dividend is not None %}
                    <span class="text-xs {% if item.days_until_dividend <= 7 %}text-orange-600 font-semibold{% else %}text-gray-500{% endif %}">
                        {% if item.days_until_dividend == 0 %}Today{% elif item.days_until_dividend < 0 %}Passed{% else %}{{ item.days_until_dividend }}d{% endif %}
                    </span>
                    {% endif %}
                </div>
                {% else %}
                <span class="text-sm text-gray-400">—</span>
                {% endif %}
            </td>
            
            <!-- Actions -->
            <td class="px-2 md:px-3 py-4" style="width: 15%;">
                <div class="flex items-center justify-center gap-1 flex-wrap">
                    <!-- View Button -->
                    <a href="{% url 'stock_detail' item.stock.symbol %}" 
                       class="inline-flex items-center justify-center px-2 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium text-xs"
                       title="View">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                    </a>
                    
                    <!-- Add to Portfolio Button -->
                    <button onclick="openPortfolioModal('{{ item.stock.symbol }}', '{{ item.stock.company_name|escapejs }}')" 
                            class="inline-flex items-center justify-center px-2 py-1.5 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition font-medium text-xs"
                            title="Add to portfolio">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </button>
                    
                    <!-- Set Alert Button -->
                    {% if item.latest_dividend %}
                    <a href="{% url 'manage_dividend_alerts' item.stock.symbol %}" 
                       class="inline-flex items-center justify-center px-2 py-1.5 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition font-medium text-xs"
                       title="Set alert">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                    </a>
                    {% endif %}
                    
                    <!-- Set Group Button -->
                    <button onclick="openGroupModal({{ item.watchlist_item.id }}, '{{ item.stock.symbol|escapejs }}')" 
                            class="inline-flex items-center justify-center px-2 py-1.5 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg transition font-medium text-xs"
                            title="Set group">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                    </button>
                    
                    <!-- Remove Button -->
                    <button onclick="showRemoveConfirm({{ item.stock.id }}, '{{ item.stock.symbol|escapejs }}')" 
                            class="inline-flex items-center justify-center px-2 py-1.5 bg-red-100 text-red-700 hover:bg-red-200 border border-red-300 rounded-lg transition font-medium text-xs"
                            title="Remove">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

